const grpc = require("@grpc/grpc-js");
const device_profile_grpc_pb = require("@chirpstack/chirpstack-api/api/device_profile_grpc_pb");
const device_profile_pb = require("@chirpstack/chirpstack-api/api/device_profile_pb");
// This must point to the ChirpStack API interface.
const serverChirpStack = "192.168.50.54:8080";
// The API token (can be obtained through the ChirpStack web-interface).
const apiToken = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJjaGlycHN0YWNrIiwiaXNzIjoiY2hpcnBzdGFjayIsInN1YiI6IjJmZjMzODRiLWZjYzgtNDE5OS1hNmY0LWVjYWEwNzUyMmE5NiIsInR5cCI6ImtleSJ9.HcJsMD_Vv-oPUFHqRIDo_xPlJOPPzNeNxSsixNXTRX0";
// Create the client for the DeviceService.
const deviceProfileService = new device_profile_grpc_pb.DeviceProfileServiceClient(
  serverChirpStack,
  grpc.credentials.createInsecure(),
);
// Create the Metadata object.
const metadata = new grpc.Metadata();
metadata.set("authorization", "Bearer " + apiToken);

function createDeviceProfileRequest_to_chirpstack() {
    // Create a device profile.
    const newDeviceProfile = new device_profile_pb.DeviceProfile();
    newDeviceProfile.setName("");
    newDeviceProfile.setDescription("");

    newDeviceProfile.setTenantId("");

    // Create a request to new device profile.
    const createReq = new device_profile_pb.CreateDeviceProfileRequest();
    createReq.setDeviceProfile(newDeviceProfile);

    deviceProfileService.create(createReq, metadata, (err, resp) => {
    if (err !== null) {
        console.log(err);
        return;
    }
    console.log('Device Profile has been created.\n' + 
    resp.toObject());
    });
}

createDeviceProfileRequest_to_chirpstack();